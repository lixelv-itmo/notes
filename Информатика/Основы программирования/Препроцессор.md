## Определение
**Препроцессор** - это программа, которая обрабатывает исходный код *до* компиляции. Препроцессор выполняет текстовые подстановки и условную компиляцию на основе директив, начинающихся с символа `#`. Позволяет выполнять код до компиляции.

---
## Основные директивы

### \#include
Включает содержимое файла в текущий файл.
```cpp
#include <iostream>     // стандартная библиотека
#include "myheader.h"   // пользовательский заголовочный файл
```

### \#define
Определяет макрос - текстовую подстановку.
```cpp
#define PI 3.14159
#define MAX(a, b) ((a) > (b) ? (a) : (b))

double area = PI * r * r;
int maximum = MAX(10, 20);  // разворачивается в ((10) > (20) ? (10) : (20))
```

### \#undef
Отменяет определение макроса.
```cpp
#define TEMP 100
#undef TEMP  // TEMP больше не определён
```

---
## Условная компиляция

### \#ifdef / \#ifndef / \#endif
Проверяет, определён ли макрос.
```cpp
#define DEBUG

#ifdef DEBUG
    std::cout << "Debug mode ON" << std::endl;
#endif

#ifndef RELEASE
    std::cout << "Not in release mode" << std::endl;
#endif
```

### \#if / \#elif / \#else
Условная компиляция на основе выражения.
```cpp
#define VERSION 2

#if VERSION == 1
    std::cout << "Version 1" << std::endl;
#elif VERSION == 2
    std::cout << "Version 2" << std::endl;
#else
    std::cout << "Unknown version" << std::endl;
#endif
```

---
## Include Guards
Предотвращают повторное включение заголовочного файла.

**Традиционный способ:**
```cpp
// myheader.h
#ifndef MYHEADER_H
#define MYHEADER_H

// содержимое заголовочного файла

#endif
```

**Современный способ:**
```cpp
// myheader.h
#pragma once

// содержимое заголовочного файла
```

---
## Полезные предопределённые макросы
```cpp
__FILE__      // имя текущего файла
__LINE__      // номер текущей строки
__DATE__      // дата компиляции
__TIME__      // время компиляции
__cplusplus   // версия стандарта C++

std::cout << "Файл: " << __FILE__ << std::endl;
std::cout << "Строка: " << __LINE__ << std::endl;
```

---
## Пример использования
```cpp
#include <iostream>

#define DEBUG
#define SQUARE(x) ((x) * (x))
#define MAX_SIZE 100

int main() {
    #ifdef DEBUG
        std::cout << "Debug mode" << std::endl;
    #endif
    
    int area = SQUARE(5);  // разворачивается в ((5) * (5))
    std::cout << "Area: " << area << std::endl;  // 25
    
    int arr[MAX_SIZE];
    
    return 0;
}
```

---
## ⚠️ Предостережения
- Макросы не имеют типов и не проверяются компилятором
- Предпочитайте `const` и `inline` функции вместо макросов
- Всегда заключайте аргументы макросов в скобки
- Макросы могут привести к неожиданным ошибкам

```cpp
// Плохо
#define SQUARE(x) x * x
int result = SQUARE(2 + 3);  // разворачивается в 2 + 3 * 2 + 3 = 11 (неправильно!)

// Хорошо
#define SQUARE(x) ((x) * (x))
int result = SQUARE(2 + 3);  // разворачивается в ((2 + 3) * (2 + 3)) = 25 (правильно)
```

---

## [Wiki](https://ru.wikipedia.org/wiki/Препроцессор_Си) [W3](https://www.w3schools.com/c/c_macros.php)